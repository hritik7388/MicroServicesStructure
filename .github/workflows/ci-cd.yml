name: Microservices CI/CD - Learning Mode

# Trigger workflow on push or PR to main branch
on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  build-deploy:
    runs-on: ubuntu-latest

    steps:
    # -------------------------------------------------
    # 1️⃣ Checkout code
    # This step pulls the latest code from GitHub
    - name: Checkout code
      uses: actions/checkout@v3

    # -------------------------------------------------
    # 2️⃣ Setup Docker Buildx (optional, harmless)
    # Needed for multi-arch builds in Docker, safe to include even if we skip builds
    - name: Setup Docker Buildx
      uses: docker/setup-buildx-action@v2

    # -------------------------------------------------
    # 3️⃣ Build SuperAdmin (Learning mode)
    # In learning mode, we skip the actual Docker build.
    # Only logs are printed to show pipeline step is reached
    - name: Build SuperAdmin
      run: |
        echo "Step 1: Building SuperAdmin... (learning mode, skipping Docker build)"
        # To enable real build later, uncomment below:
        # docker build -t superadmin:latest ./superAdmin-service

    # -------------------------------------------------
    # 4️⃣ Build Subadmin (Learning mode)
    - name: Build Subadmin
      run: |
        echo "Step 2: Building Subadmin... (learning mode, skipping Docker build)"
        # To enable real build later, uncomment below:
        # if [ -f ./subadmin-service/Dockerfile ]; then
        #   docker build -t subadmin:latest ./subadmin-service
        # else
        #   echo "Subadmin service does not exist. Skipping..."
        # fi

    # -------------------------------------------------
    # 5️⃣ Build API Gateway (Learning mode)
    - name: Build API Gateway
      run: |
        echo "Step 3: Building API Gateway... (learning mode, skipping Docker build)"
        # To enable real build later, uncomment below:
        # if [ -f ./api-gateway/Dockerfile ]; then
        #   docker build -t api-gateway:latest ./api-gateway
        # else
        #   echo "API Gateway service does not exist. Skipping..."
        # fi

    # -------------------------------------------------
    # 6️⃣ Docker Hub login (Learning mode skipped)
    # Uncomment for production mode
    # - name: Docker Hub Login
    #   uses: docker/login-action@v2
    #   with:
    #     username: ${{ secrets.DOCKER_HUB_USERNAME }}
    #     password: ${{ secrets.DOCKER_HUB_PASSWORD }}

    # -------------------------------------------------
    # 7️⃣ Deploy to server via SSH (Learning mode skipped)
    # Uncomment for production mode
    # - name: Deploy to Server
    #   uses: appleboy/ssh-action@v0.1.9
    #   with:
    #     host: ${{ secrets.DEPLOY_SERVER }}
    #     username: ${{ secrets.SERVER_USER }}
    #     key: ${{ secrets.SERVER_SSH_KEY }}
    #     script: |
    #       cd /home/ubuntu/microservicesstructure
    #       docker-compose pull
    #       docker-compose up -d --build
